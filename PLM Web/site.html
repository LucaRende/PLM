<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRO SYSTEM ‚Äî Automazione Industriale</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@300;400;500&family=Outfit:wght@200;300;400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #060810;
  --surface: #0d111d;
  --primary: #00d4ff;
  --secondary: #ff6b2b;
  --green: #2aff8a;
  --text: #c8cdd8;
  --muted: #4a5068;
  --dim: #1e2235;
}

html { background: var(--bg); }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

::-webkit-scrollbar { width: 0; }

/* Fixed Canvas */
#bg {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 0;
}

/* Atmospheric Overlays */
.vignette {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(ellipse at center, transparent 40%, rgba(6,8,16,0.7) 100%);
  pointer-events: none;
  z-index: 1;
}

.noise {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 2;
  opacity: 0.025;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

.scanlines {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 2;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.015) 2px,
    rgba(0,0,0,0.015) 4px
  );
}

/* Scroll Spacer */
#scroll-spacer {
  height: 600vh;
  position: relative;
  z-index: -1;
}

/* Navigation */
nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 100;
  padding: 32px 48px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: opacity 0.5s ease;
}

.nav-logo {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.6rem;
  letter-spacing: 6px;
  color: var(--text);
}

.nav-logo span {
  color: var(--primary);
}

.nav-links {
  display: flex;
  gap: 36px;
  list-style: none;
}

.nav-links a {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  font-weight: 400;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted);
  text-decoration: none;
  transition: color 0.4s ease;
  position: relative;
}

.nav-links a:hover { color: var(--primary); }

/* Progress Bar */
.progress-track {
  position: fixed;
  right: 32px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 100;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.progress-line {
  width: 1px;
  height: 120px;
  background: var(--dim);
  position: relative;
  border-radius: 1px;
  overflow: hidden;
}

.progress-fill {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 0%;
  background: var(--primary);
  transition: height 0.1s linear;
  border-radius: 1px;
  box-shadow: 0 0 8px var(--primary);
}

.progress-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  color: var(--muted);
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transform: rotate(180deg);
  transition: color 0.3s ease;
}

.progress-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--primary);
  box-shadow: 0 0 10px var(--primary), 0 0 20px rgba(0,212,255,0.3);
  animation: progressPulse 2s ease infinite;
}

/* Panels */
.panel {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 10;
  display: flex;
  align-items: center;
  pointer-events: none;
  opacity: 0;
  transition: none;
}

.panel.active { pointer-events: auto; }

/* Hero Panel */
.hero-content {
  width: 100%;
  text-align: center;
  padding: 0 48px;
}

.hero-tag {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--primary);
  margin-bottom: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.hero-tag .pulse-dot {
  width: 6px;
  height: 6px;
  background: var(--primary);
  border-radius: 50%;
  animation: progressPulse 2s ease infinite;
  box-shadow: 0 0 8px var(--primary);
}

.hero-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(4rem, 12vw, 11rem);
  letter-spacing: 4px;
  line-height: 0.92;
  color: var(--text);
  margin-bottom: 28px;
}

.hero-title .line2 {
  display: block;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-sub {
  font-family: 'Outfit', sans-serif;
  font-weight: 300;
  font-size: 1.1rem;
  color: var(--muted);
  max-width: 440px;
  margin: 0 auto;
  line-height: 1.7;
}

.scramble-char {
  color: var(--primary);
  opacity: 0.6;
}

.scroll-hint {
  position: absolute;
  bottom: 48px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.scroll-hint span {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--muted);
}

.scroll-arrow {
  width: 1px;
  height: 40px;
  position: relative;
  overflow: hidden;
}

.scroll-arrow::after {
  content: '';
  position: absolute;
  top: -100%;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, transparent, var(--primary));
  animation: scrollDown 2s ease infinite;
}

/* Info Panels (About, Services, Tech) */
.info-layout {
  width: 100%;
  padding: 0 80px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 80px;
  align-items: center;
}

.info-left .section-num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 4px;
  color: var(--primary);
  text-transform: uppercase;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.info-left .section-num::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--dim);
  max-width: 60px;
}

.info-left h2 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(3rem, 6vw, 5.5rem);
  letter-spacing: 2px;
  line-height: 0.95;
  color: var(--text);
  margin-bottom: 0;
}

.info-left h2 em {
  font-style: normal;
  color: var(--primary);
}

.info-right {
  padding-top: 40px;
}

.info-right p {
  font-weight: 300;
  font-size: 1rem;
  color: var(--muted);
  line-height: 1.8;
  margin-bottom: 32px;
}

.info-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}

.stat {
  padding: 20px;
  border: 1px solid var(--dim);
  border-radius: 12px;
  background: rgba(13,17,29,0.5);
  backdrop-filter: blur(10px);
}

.stat-value {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2.5rem;
  letter-spacing: 1px;
  color: var(--text);
  line-height: 1;
}

.stat-value span { color: var(--primary); }

.stat-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted);
  margin-top: 6px;
}

/* Services Grid */
.services-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 16px;
}

.service-card {
  padding: 28px 24px;
  border: 1px solid var(--dim);
  border-radius: 14px;
  background: rgba(13,17,29,0.4);
  backdrop-filter: blur(10px);
  transition: border-color 0.4s ease, transform 0.4s ease;
  cursor: default;
}

.service-card:hover {
  border-color: rgba(0,212,255,0.2);
  transform: translateY(-4px);
}

.service-icon {
  font-size: 1.4rem;
  margin-bottom: 16px;
}

.service-card h4 {
  font-family: 'Outfit', sans-serif;
  font-weight: 600;
  font-size: 0.95rem;
  color: var(--text);
  margin-bottom: 8px;
}

.service-card p {
  font-size: 0.78rem;
  color: var(--muted);
  line-height: 1.6;
  font-weight: 300;
}

.service-tag {
  display: inline-block;
  margin-top: 12px;
  padding: 4px 10px;
  border-radius: 100px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.5rem;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  border: 1px solid;
}

.tag-cyan { color: var(--primary); border-color: rgba(0,212,255,0.2); background: rgba(0,212,255,0.05); }
.tag-orange { color: var(--secondary); border-color: rgba(255,107,43,0.2); background: rgba(255,107,43,0.05); }
.tag-green { color: var(--green); border-color: rgba(42,255,138,0.2); background: rgba(42,255,138,0.05); }

/* Contact Panel */
.contact-content {
  width: 100%;
  text-align: center;
  padding: 0 48px;
}

.contact-content h2 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(3.5rem, 10vw, 9rem);
  letter-spacing: 4px;
  line-height: 0.92;
  color: var(--text);
  margin-bottom: 24px;
}

.contact-content h2 em {
  font-style: normal;
  background: linear-gradient(90deg, var(--primary), var(--green));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.contact-content p {
  font-weight: 300;
  font-size: 1.05rem;
  color: var(--muted);
  max-width: 420px;
  margin: 0 auto 48px;
  line-height: 1.7;
}

.cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 18px 44px;
  border: 1px solid var(--primary);
  border-radius: 60px;
  background: rgba(0,212,255,0.06);
  color: var(--primary);
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.72rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.cta-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--primary);
  opacity: 0;
  transition: opacity 0.4s ease;
}

.cta-btn:hover::before { opacity: 0.12; }

.cta-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 40px rgba(0,212,255,0.2);
  border-color: var(--primary);
}

.cta-btn span { position: relative; z-index: 1; }

.cta-arrow {
  position: relative;
  z-index: 1;
  transition: transform 0.3s ease;
}

.cta-btn:hover .cta-arrow { transform: translateX(4px); }

/* Footer */
.site-footer {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  z-index: 10;
  padding: 24px 48px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  opacity: 0;
  transition: opacity 0.5s ease;
  pointer-events: none;
}

.site-footer.visible { opacity: 1; pointer-events: auto; }

.footer-text {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 2px;
  color: var(--muted);
}

/* Shape Label */
.shape-label {
  position: fixed;
  bottom: 32px;
  left: 48px;
  z-index: 50;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--muted);
  display: flex;
  align-items: center;
  gap: 10px;
  transition: opacity 0.4s ease;
}

.shape-label .indicator {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--primary);
  box-shadow: 0 0 8px var(--primary);
}

/* Keyframes */
@keyframes progressPulse {
  0%, 100% { opacity: 1; box-shadow: 0 0 10px var(--primary), 0 0 20px rgba(0,212,255,0.3); }
  50% { opacity: 0.5; box-shadow: 0 0 5px var(--primary), 0 0 10px rgba(0,212,255,0.1); }
}

@keyframes scrollDown {
  0% { top: -100%; }
  100% { top: 200%; }
}

/* Responsive */
@media (max-width: 900px) {
  nav { padding: 20px 24px; }
  .nav-links { display: none; }
  .info-layout { grid-template-columns: 1fr; padding: 0 28px; gap: 40px; }
  .info-right { padding-top: 0; }
  .services-grid { grid-template-columns: 1fr; }
  .progress-track { right: 16px; }
  .hero-content, .contact-content { padding: 0 24px; }
  .shape-label { left: 24px; bottom: 24px; }
  .info-stats { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<canvas id="bg"></canvas>
<div class="vignette"></div>
<div class="noise"></div>
<div class="scanlines"></div>

<!-- Navigation -->
<nav>
  <div class="nav-logo">PRO<span>.</span>SYSTEM</div>
  <ul class="nav-links">
    <li><a href="#" data-target="0.22">Chi Siamo</a></li>
    <li><a href="#" data-target="0.42">Servizi</a></li>
    <li><a href="#" data-target="0.62">Tecnologia</a></li>
    <li><a href="#" data-target="0.88">Contatti</a></li>
  </ul>
</nav>

<!-- Progress -->
<div class="progress-track">
  <div class="progress-dot"></div>
  <div class="progress-line"><div class="progress-fill" id="progress-fill"></div></div>
  <div class="progress-label" id="progress-label">00</div>
</div>

<!-- Shape Label -->
<div class="shape-label" id="shape-label">
  <span class="indicator"></span>
  <span id="shape-name">particles.init</span>
</div>

<!-- Scroll Spacer -->
<div id="scroll-spacer"></div>

<!-- ===== PANELS ===== -->

<!-- Hero -->
<div class="panel" id="panel-hero">
  <div class="hero-content">
    <div class="hero-tag"><span class="pulse-dot"></span> Automazione Industriale 4.0</div>
    <h1 class="hero-title">
      <span class="line1" id="hero-line1">AUTOMAZIONE</span>
      <span class="line2" id="hero-line2">SENZA CONFINI</span>
    </h1>
    <p class="hero-sub">Progettiamo, installiamo e integriamo macchinari industriali all'avanguardia. Dall'idea alla produzione, con precisione assoluta.</p>
    <div class="scroll-hint">
      <span>Scroll</span>
      <div class="scroll-arrow"></div>
    </div>
  </div>
</div>

<!-- About -->
<div class="panel" id="panel-about">
  <div class="info-layout">
    <div class="info-left">
      <div class="section-num">01 ‚Äî Chi Siamo</div>
      <h2>INGEGNERIA<br>CHE SUPERA<br>I <em>LIMITI</em></h2>
    </div>
    <div class="info-right">
      <p>Da oltre 15 anni progettiamo e installiamo sistemi di automazione industriale su misura. Ogni impianto √® una sfida ingegneristica, ogni soluzione √® unica. Trasformiamo le linee produttive in ecosistemi intelligenti.</p>
      <div class="info-stats">
        <div class="stat">
          <div class="stat-value">250<span>+</span></div>
          <div class="stat-label">Impianti installati</div>
        </div>
        <div class="stat">
          <div class="stat-value">98<span>%</span></div>
          <div class="stat-label">Soddisfazione</div>
        </div>
        <div class="stat">
          <div class="stat-value">15<span>y</span></div>
          <div class="stat-label">Esperienza</div>
        </div>
        <div class="stat">
          <div class="stat-value">24<span>/7</span></div>
          <div class="stat-label">Assistenza</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Services -->
<div class="panel" id="panel-services">
  <div class="info-layout">
    <div class="info-left">
      <div class="section-num">02 ‚Äî Servizi</div>
      <h2>SOLUZIONI<br><em>COMPLETE</em><br>PER L'INDUSTRIA</h2>
    </div>
    <div class="info-right">
      <div class="services-grid">
        <div class="service-card">
          <div class="service-icon">‚öôÔ∏è</div>
          <h4>Cobot Integration</h4>
          <p>Robot collaborativi per assemblaggio, saldatura e pick & place di precisione.</p>
          <span class="service-tag tag-cyan">Robotica</span>
        </div>
        <div class="service-card">
          <div class="service-icon">üîß</div>
          <h4>CNC Programming</h4>
          <p>Programmazione e ottimizzazione centri di lavoro multi-asse.</p>
          <span class="service-tag tag-orange">Produzione</span>
        </div>
        <div class="service-card">
          <div class="service-icon">üì°</div>
          <h4>IoT Monitoring</h4>
          <p>Sensori connessi e dashboard real-time per il controllo totale.</p>
          <span class="service-tag tag-green">Industry 4.0</span>
        </div>
        <div class="service-card">
          <div class="service-icon">üõ°Ô∏è</div>
          <h4>Manutenzione AI</h4>
          <p>Algoritmi predittivi che anticipano guasti e ottimizzano fermi macchina.</p>
          <span class="service-tag tag-cyan">AI</span>
        </div>
        <div class="service-card">
          <div class="service-icon">‚úÇÔ∏è</div>
          <h4>Taglio Laser</h4>
          <p>Sistemi di taglio ad alta precisione con ottimizzazione nesting avanzata.</p>
          <span class="service-tag tag-orange">Precisione</span>
        </div>
        <div class="service-card">
          <div class="service-icon">üè≠</div>
          <h4>Digital Twin</h4>
          <p>Replica digitale dell'impianto con simulazione e analytics in tempo reale.</p>
          <span class="service-tag tag-green">Simulazione</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Tech -->
<div class="panel" id="panel-tech">
  <div class="info-layout">
    <div class="info-left">
      <div class="section-num">03 ‚Äî Tecnologia</div>
      <h2>SMART<br><em>FACTORY</em><br>ECOSYSTEM</h2>
    </div>
    <div class="info-right">
      <p>La nostra piattaforma integra ogni livello dell'automazione: dalla sensoristica edge ai sistemi SCADA, dall'analisi predittiva al controllo remoto. Un ecosistema completo, pensato per scalare.</p>
      <div class="info-stats">
        <div class="stat">
          <div class="stat-value" style="font-size:1.4rem; font-family:'JetBrains Mono',monospace; color:var(--primary); letter-spacing:1px;">PLC ¬∑ SCADA</div>
          <div class="stat-label">Controllo</div>
        </div>
        <div class="stat">
          <div class="stat-value" style="font-size:1.4rem; font-family:'JetBrains Mono',monospace; color:var(--secondary); letter-spacing:1px;">ML ¬∑ EDGE AI</div>
          <div class="stat-label">Intelligenza</div>
        </div>
        <div class="stat">
          <div class="stat-value" style="font-size:1.4rem; font-family:'JetBrains Mono',monospace; color:var(--green); letter-spacing:1px;">MQTT ¬∑ OPC-UA</div>
          <div class="stat-label">Protocolli</div>
        </div>
        <div class="stat">
          <div class="stat-value" style="font-size:1.4rem; font-family:'JetBrains Mono',monospace; color:var(--text); letter-spacing:1px;">ISO 9001</div>
          <div class="stat-label">Certificazione</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Contact -->
<div class="panel" id="panel-contact">
  <div class="contact-content">
    <h2>COSTRUIAMO<br>IL <em>FUTURO</em></h2>
    <p>Il prossimo passo della tua produzione inizia con una conversazione. Parliamone.</p>
    <a href="mailto:info@prosystem.it" class="cta-btn">
      <span>Richiedi Preventivo</span>
      <span class="cta-arrow">‚Üí</span>
    </a>
  </div>
</div>

<!-- Footer -->
<div class="site-footer" id="site-footer">
  <span class="footer-text">¬© 2026 PRO SYSTEM S.R.L.</span>
  <span class="footer-text">MODENA, ITALY</span>
</div>

<script>
// =====================================================
// THREE.JS SETUP
// =====================================================
const canvas = document.getElementById('bg');
const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: false });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.setClearColor(0x060810, 1);

const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x060810, 0.025);

const camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 200);
camera.position.set(0, 0, 12);

// =====================================================
// SHAPE GENERATORS
// =====================================================
const COUNT = 5000;

function genSphere(n, radius) {
  const p = new Float32Array(n * 3);
  for (let i = 0; i < n; i++) {
    const theta = Math.random() * Math.PI * 2;
    const phi = Math.acos(2 * Math.random() - 1);
    const r = radius * (0.85 + Math.random() * 0.15);
    p[i*3]   = r * Math.sin(phi) * Math.cos(theta);
    p[i*3+1] = r * Math.sin(phi) * Math.sin(theta);
    p[i*3+2] = r * Math.cos(phi);
  }
  return p;
}

function genRobotArm(n) {
  const p = new Float32Array(n * 3);
  const segs = [
    { s:[0,-3.5,0], e:[0,-2,0], w:1.0 },
    { s:[0,-2,0], e:[0,0,0], w:0.55 },
    { s:[0,0,0], e:[0,0.3,0], w:0.7 },
    { s:[0,0.3,0], e:[2,2.2,0], w:0.4 },
    { s:[2,2.2,0], e:[2,2.5,0], w:0.55 },
    { s:[2,2.5,0], e:[4,1.8,0], w:0.32 },
    { s:[4,1.8,0], e:[4,2.1,0], w:0.4 },
    { s:[4,2.1,0], e:[5,1.5,0.4], w:0.18 },
    { s:[4,2.1,0], e:[5,2.5,-0.4], w:0.18 },
  ];
  const totalW = segs.reduce((a,s) => {
    const dx=s.e[0]-s.s[0], dy=s.e[1]-s.s[1], dz=s.e[2]-s.s[2];
    return a + Math.sqrt(dx*dx+dy*dy+dz*dz) * s.w;
  }, 0);
  for (let i = 0; i < n; i++) {
    let r = Math.random() * totalW, cumul = 0, seg = segs[0];
    for (const s of segs) {
      const dx=s.e[0]-s.s[0], dy=s.e[1]-s.s[1], dz=s.e[2]-s.s[2];
      const len = Math.sqrt(dx*dx+dy*dy+dz*dz) * s.w;
      cumul += len;
      if (cumul >= r) { seg = s; break; }
    }
    const t = Math.random();
    const w = seg.w * (1 - t * 0.15);
    p[i*3]   = seg.s[0]+(seg.e[0]-seg.s[0])*t + (Math.random()-0.5)*w;
    p[i*3+1] = seg.s[1]+(seg.e[1]-seg.s[1])*t + (Math.random()-0.5)*w;
    p[i*3+2] = seg.s[2]+(seg.e[2]-seg.s[2])*t + (Math.random()-0.5)*w;
  }
  return p;
}

function genGear(n) {
  const p = new Float32Array(n * 3);
  const teeth = 18, innerR = 2.2, outerR = 3.2, toothH = 0.9, thick = 0.6;
  for (let i = 0; i < n; i++) {
    const chance = Math.random();
    if (chance < 0.1) {
      const a = Math.random() * Math.PI * 2;
      const r = Math.random() * 0.6;
      p[i*3] = Math.cos(a)*r;
      p[i*3+1] = Math.sin(a)*r;
      p[i*3+2] = (Math.random()-0.5)*thick*0.5;
    } else if (chance < 0.2) {
      const spoke = Math.floor(Math.random()*6);
      const a = (spoke/6)*Math.PI*2;
      const t = 0.6 + Math.random() * (innerR - 0.6);
      p[i*3] = Math.cos(a)*t + (Math.random()-0.5)*0.12;
      p[i*3+1] = Math.sin(a)*t + (Math.random()-0.5)*0.12;
      p[i*3+2] = (Math.random()-0.5)*thick*0.3;
    } else {
      const a = Math.random() * Math.PI * 2;
      const ta = (Math.PI*2)/teeth;
      const phase = ((a % ta) / ta);
      const isTooth = phase < 0.4;
      let r;
      if (isTooth) {
        r = outerR + Math.random() * toothH;
      } else {
        r = innerR + Math.random() * (outerR - innerR);
      }
      r += (Math.random()-0.5)*0.15;
      p[i*3] = Math.cos(a)*r;
      p[i*3+1] = Math.sin(a)*r;
      p[i*3+2] = (Math.random()-0.5)*thick;
    }
  }
  return p;
}

function genCircuit(n) {
  const p = new Float32Array(n * 3);
  const size = 7;
  const step = 0.55;
  for (let i = 0; i < n; i++) {
    const chance = Math.random();
    if (chance < 0.6) {
      const gx = Math.round((Math.random()-0.5)*size/step)*step;
      const gy = Math.round((Math.random()-0.5)*size/step)*step;
      p[i*3] = gx + (Math.random()-0.5)*0.08;
      p[i*3+1] = gy + (Math.random()-0.5)*0.08;
      p[i*3+2] = (Math.random()-0.5)*0.12;
    } else if (chance < 0.85) {
      const isH = Math.random() > 0.5;
      const linePos = Math.round((Math.random()-0.5)*size/step)*step;
      const t = (Math.random()-0.5)*size;
      p[i*3] = isH ? t : linePos;
      p[i*3+1] = isH ? linePos : t;
      p[i*3+2] = (Math.random()-0.5)*0.06;
    } else {
      const cx = Math.round((Math.random()-0.5)*4/step)*step;
      const cy = Math.round((Math.random()-0.5)*4/step)*step;
      const a = Math.random()*Math.PI*2;
      const r = 0.2 + Math.random()*0.15;
      p[i*3] = cx + Math.cos(a)*r;
      p[i*3+1] = cy + Math.sin(a)*r;
      p[i*3+2] = (Math.random()-0.5)*0.1;
    }
  }
  return p;
}

function genDisperse(n) {
  const p = new Float32Array(n * 3);
  for (let i = 0; i < n; i++) {
    const theta = Math.random()*Math.PI*2;
    const phi = Math.acos(2*Math.random()-1);
    const r = 10 + Math.random()*20;
    p[i*3]   = r*Math.sin(phi)*Math.cos(theta);
    p[i*3+1] = r*Math.sin(phi)*Math.sin(theta);
    p[i*3+2] = r*Math.cos(phi);
  }
  return p;
}

// Sort by angle for coherent morphing
function sortByAngle(pos, n) {
  const idx = Array.from({length:n}, (_,i)=>i);
  idx.sort((a,b) => {
    const aa = Math.atan2(pos[a*3+1], pos[a*3]) + Math.PI;
    const ba = Math.atan2(pos[b*3+1], pos[b*3]) + Math.PI;
    return aa - ba;
  });
  const sorted = new Float32Array(n*3);
  idx.forEach((orig, ni) => {
    sorted[ni*3]   = pos[orig*3];
    sorted[ni*3+1] = pos[orig*3+1];
    sorted[ni*3+2] = pos[orig*3+2];
  });
  return sorted;
}

const shapes = [
  sortByAngle(genSphere(COUNT, 4), COUNT),
  sortByAngle(genRobotArm(COUNT), COUNT),
  sortByAngle(genGear(COUNT), COUNT),
  sortByAngle(genCircuit(COUNT), COUNT),
  sortByAngle(genDisperse(COUNT), COUNT),
];

const shapeNames = ['particles.sphere', 'model.cobot_arm', 'model.gear_drive', 'layout.smart_circuit', 'particles.disperse'];

// =====================================================
// PARTICLE SYSTEM
// =====================================================
function createParticleTexture() {
  const c = document.createElement('canvas');
  c.width = 64; c.height = 64;
  const ctx = c.getContext('2d');
  const g = ctx.createRadialGradient(32,32,0,32,32,32);
  g.addColorStop(0, 'rgba(255,255,255,1)');
  g.addColorStop(0.15, 'rgba(255,255,255,0.9)');
  g.addColorStop(0.5, 'rgba(255,255,255,0.3)');
  g.addColorStop(1, 'rgba(255,255,255,0)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,64,64);
  return new THREE.CanvasTexture(c);
}

const geometry = new THREE.BufferGeometry();
const positions = new Float32Array(COUNT * 3);
const colors = new Float32Array(COUNT * 3);
const prevPositions = new Float32Array(COUNT * 3);

// Initialize to first shape
for (let i = 0; i < COUNT * 3; i++) {
  positions[i] = shapes[0][i];
  prevPositions[i] = shapes[0][i];
  colors[i] = 0;
}

geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

const material = new THREE.PointsMaterial({
  size: 0.07,
  map: createParticleTexture(),
  vertexColors: true,
  transparent: true,
  opacity: 0.92,
  blending: THREE.AdditiveBlending,
  sizeAttenuation: true,
  depthWrite: false,
});

const particles = new THREE.Points(geometry, material);
scene.add(particles);

// Ambient particles (background dust)
const dustCount = 800;
const dustGeo = new THREE.BufferGeometry();
const dustPos = new Float32Array(dustCount * 3);
for (let i = 0; i < dustCount; i++) {
  dustPos[i*3]   = (Math.random()-0.5) * 50;
  dustPos[i*3+1] = (Math.random()-0.5) * 50;
  dustPos[i*3+2] = (Math.random()-0.5) * 50;
}
dustGeo.setAttribute('position', new THREE.BufferAttribute(dustPos, 3));
const dustMat = new THREE.PointsMaterial({
  size: 0.02,
  color: 0x2a3555,
  transparent: true,
  opacity: 0.5,
  blending: THREE.AdditiveBlending,
  depthWrite: false,
});
const dust = new THREE.Points(dustGeo, dustMat);
scene.add(dust);

// =====================================================
// SCROLL STATE
// =====================================================
let scrollProgress = 0;
let currentShapeIdx = 0;
let morphProgress = 0;

const transitions = [
  { start: 0.13, end: 0.22, from: 0, to: 1 },
  { start: 0.33, end: 0.42, from: 1, to: 2 },
  { start: 0.53, end: 0.62, from: 2, to: 3 },
  { start: 0.76, end: 0.86, from: 3, to: 4 },
];

const panelZones = [
  { id: 'panel-hero',     in: 0.0,  peak: 0.04, out: 0.11 },
  { id: 'panel-about',    in: 0.19, peak: 0.26, out: 0.31 },
  { id: 'panel-services', in: 0.39, peak: 0.46, out: 0.51 },
  { id: 'panel-tech',     in: 0.59, peak: 0.68, out: 0.74 },
  { id: 'panel-contact',  in: 0.84, peak: 0.92, out: 1.01 },
];

// Base colors (R,G,B in 0-1)
const baseColor   = { r: 0.0, g: 0.5, b: 0.7 };   // cool teal
const fastColor   = { r: 1.0, g: 0.42, b: 0.17 };  // hot orange
const accentColor = { r: 0.0, g: 0.83, b: 1.0 };   // electric cyan

// =====================================================
// EASING
// =====================================================
function easeInOutCubic(t) {
  return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2, 3)/2;
}

function lerp(a, b, t) { return a + (b - a) * t; }

function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

function mapRange(val, inMin, inMax, outMin, outMax) {
  return clamp((val - inMin) / (inMax - inMin), 0, 1) * (outMax - outMin) + outMin;
}

// =====================================================
// MOUSE
// =====================================================
let mouseX = 0, mouseY = 0;
let targetMX = 0, targetMY = 0;

document.addEventListener('mousemove', e => {
  targetMX = (e.clientX / window.innerWidth - 0.5) * 2;
  targetMY = (e.clientY / window.innerHeight - 0.5) * 2;
});

// =====================================================
// TEXT SCRAMBLE
// =====================================================
class TextScramble {
  constructor(el) {
    this.el = el;
    this.chars = '!<>-_\\/[]{}‚Äî=+*^?#‚ñì‚ñí‚ñë';
    this.frameReq = null;
  }
  setText(text) {
    const old = this.el.textContent;
    const len = Math.max(old.length, text.length);
    const promise = new Promise(r => this.resolve = r);
    this.queue = [];
    for (let i = 0; i < len; i++) {
      const from = old[i] || '';
      const to = text[i] || '';
      const start = Math.floor(Math.random() * 30);
      const end = start + Math.floor(Math.random() * 30);
      this.queue.push({from, to, start, end});
    }
    cancelAnimationFrame(this.frameReq);
    this.frame = 0;
    this.update();
    return promise;
  }
  update() {
    let output = '', complete = 0;
    for (let i = 0; i < this.queue.length; i++) {
      let {from, to, start, end, char} = this.queue[i];
      if (this.frame >= end) { complete++; output += to; }
      else if (this.frame >= start) {
        if (!char || Math.random() < 0.28) {
          char = this.chars[Math.floor(Math.random()*this.chars.length)];
          this.queue[i].char = char;
        }
        output += `<span class="scramble-char">${char}</span>`;
      } else output += from;
    }
    this.el.innerHTML = output;
    if (complete === this.queue.length) this.resolve();
    else { this.frameReq = requestAnimationFrame(() => this.update()); this.frame++; }
  }
}

// Init hero text scramble
const scramble1 = new TextScramble(document.getElementById('hero-line1'));
const scramble2 = new TextScramble(document.getElementById('hero-line2'));
setTimeout(() => scramble1.setText('AUTOMAZIONE'), 500);
setTimeout(() => scramble2.setText('SENZA CONFINI'), 900);

// =====================================================
// SCROLL HANDLER
// =====================================================
const spacer = document.getElementById('scroll-spacer');

function updateScroll() {
  const maxScroll = spacer.offsetHeight - window.innerHeight;
  scrollProgress = clamp(window.scrollY / maxScroll, 0, 1);
  
  // Progress bar
  document.getElementById('progress-fill').style.height = (scrollProgress * 100) + '%';
  document.getElementById('progress-label').textContent = String(Math.floor(scrollProgress * 100)).padStart(2, '0');
  
  // Panel visibility
  panelZones.forEach(zone => {
    const el = document.getElementById(zone.id);
    let opacity = 0;
    if (scrollProgress >= zone.in && scrollProgress <= zone.out) {
      if (scrollProgress < zone.peak) {
        opacity = mapRange(scrollProgress, zone.in, zone.peak, 0, 1);
      } else {
        opacity = mapRange(scrollProgress, zone.peak, zone.out, 1, 0);
      }
    }
    el.style.opacity = opacity;
    el.classList.toggle('active', opacity > 0.1);
  });

  // Footer
  document.getElementById('site-footer').classList.toggle('visible', scrollProgress > 0.88);

  // Determine shape state
  let fromShape = 0, toShape = 0, tween = 0;
  let inTransition = false;

  for (const tr of transitions) {
    if (scrollProgress >= tr.start && scrollProgress <= tr.end) {
      fromShape = tr.from;
      toShape = tr.to;
      tween = easeInOutCubic((scrollProgress - tr.start) / (tr.end - tr.start));
      inTransition = true;
      break;
    }
    if (scrollProgress > tr.end) {
      fromShape = tr.to;
      toShape = tr.to;
    }
  }

  currentShapeIdx = inTransition ? toShape : fromShape;
  morphProgress = tween;

  // Update shape label
  const labelIdx = inTransition ? toShape : fromShape;
  document.getElementById('shape-name').textContent = shapeNames[labelIdx];

  // Morph particles
  const fromArr = shapes[fromShape];
  const toArr = inTransition ? shapes[toShape] : fromArr;
  const t = inTransition ? tween : 0;

  for (let i = 0; i < COUNT * 3; i++) {
    prevPositions[i] = positions[i];
    positions[i] = lerp(fromArr[i], toArr[i], t);
  }
  geometry.attributes.position.needsUpdate = true;

  // Speed-based coloring
  let maxSpeed = 0;
  const speeds = new Float32Array(COUNT);
  for (let i = 0; i < COUNT; i++) {
    const dx = positions[i*3] - prevPositions[i*3];
    const dy = positions[i*3+1] - prevPositions[i*3+1];
    const dz = positions[i*3+2] - prevPositions[i*3+2];
    speeds[i] = Math.sqrt(dx*dx + dy*dy + dz*dz);
    if (speeds[i] > maxSpeed) maxSpeed = speeds[i];
  }
  if (maxSpeed < 0.001) maxSpeed = 0.001;

  for (let i = 0; i < COUNT; i++) {
    const s = clamp(speeds[i] / (maxSpeed * 0.6), 0, 1);
    const s2 = s * s;
    colors[i*3]   = lerp(lerp(baseColor.r, accentColor.r, 0.5), fastColor.r, s2);
    colors[i*3+1] = lerp(lerp(baseColor.g, accentColor.g, 0.5), fastColor.g, s2);
    colors[i*3+2] = lerp(lerp(baseColor.b, accentColor.b, 0.5), fastColor.b, s2);
  }
  geometry.attributes.color.needsUpdate = true;

  // Dynamic particle size based on transition
  material.size = inTransition ? lerp(0.07, 0.12, Math.sin(tween * Math.PI)) : 0.07;
}

window.addEventListener('scroll', updateScroll, { passive: true });

// Nav link scroll
document.querySelectorAll('.nav-links a').forEach(a => {
  a.addEventListener('click', e => {
    e.preventDefault();
    const target = parseFloat(a.dataset.target);
    const maxScroll = spacer.offsetHeight - window.innerHeight;
    window.scrollTo({ top: target * maxScroll, behavior: 'smooth' });
  });
});

// =====================================================
// ANIMATION LOOP
// =====================================================
const clock = new THREE.Clock();

function animate() {
  requestAnimationFrame(animate);
  const time = clock.getElapsedTime();

  // Smooth mouse
  mouseX += (targetMX - mouseX) * 0.04;
  mouseY += (targetMY - mouseY) * 0.04;

  // Camera
  camera.position.x = mouseX * 1.5;
  camera.position.y = -mouseY * 1.0;
  camera.lookAt(0, 0, 0);

  // Gentle particle rotation
  particles.rotation.y = time * 0.04 + scrollProgress * 0.5;
  particles.rotation.x = Math.sin(time * 0.02) * 0.08;

  // Dust rotation
  dust.rotation.y = time * 0.01;
  dust.rotation.x = time * 0.005;

  renderer.render(scene, camera);
}
animate();

// Initial scroll update
updateScroll();

// =====================================================
// RESIZE
// =====================================================
window.addEventListener('resize', () => {
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
});

// =====================================================
// SERVICE CARD HOVER GLOW
// =====================================================
document.querySelectorAll('.service-card').forEach(card => {
  card.addEventListener('mousemove', e => {
    const r = card.getBoundingClientRect();
    const x = ((e.clientX - r.left) / r.width) * 100;
    const y = ((e.clientY - r.top) / r.height) * 100;
    card.style.background = `radial-gradient(circle at ${x}% ${y}%, rgba(0,212,255,0.06) 0%, rgba(13,17,29,0.4) 60%)`;
  });
  card.addEventListener('mouseleave', () => {
    card.style.background = 'rgba(13,17,29,0.4)';
  });
});
</script>
</body>
</html>
