-- =============================================
-- PLM Web - Creazione Utente Admin
-- Esegui questo script nel SQL Editor di Supabase
-- =============================================

-- Abilita estensione per hashing password (se non già attiva)
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- =============================================
-- INSERIMENTO UTENTE ADMIN
-- IMPORTANTE: Cambia la password prima di eseguire!
-- =============================================

INSERT INTO accounts (
    username,
    password_hash,
    nome,
    cognome,
    email,
    ruolo,
    attivo
) VALUES (
    'admin',                                          -- Username
    crypt('CambiaQuestaPassword123!', gen_salt('bf', 10)),  -- Password (CAMBIALA!)
    'Amministratore',                                 -- Nome
    'Sistema',                                        -- Cognome
    'admin@prosystem.it',                            -- Email
    'admin',                                          -- Ruolo (admin = accesso totale)
    true                                              -- Attivo
);

-- =============================================
-- VERIFICA INSERIMENTO
-- =============================================
SELECT 
    id,
    username,
    nome,
    cognome,
    email,
    ruolo,
    attivo,
    created_at
FROM accounts 
WHERE username = 'admin';

-- =============================================
-- NOTE:
-- 
-- Per verificare la password in fase di login usa:
-- SELECT * FROM accounts 
-- WHERE username = 'tuousername' 
-- AND password_hash = crypt('passwordinserita', password_hash);
--
-- Ruoli disponibili:
-- - 'admin'   → Accesso completo a tutto
-- - 'utente'  → Accesso limitato (da definire)
-- =============================================
